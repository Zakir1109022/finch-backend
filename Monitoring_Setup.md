# Monitoring\_Setup.md

## Overview

This document outlines the monitoring architecture for the Finch Backend application using **Prometheus**, **Grafana**, and **Loki** in a Kubernetes environment. It includes deployment descriptions, metric and log collection methods, and dashboard/alert configuration instructions.

---

## üîß Tools Used

| Tool              | Purpose                                                                      |
| ----------------- | ---------------------------------------------------------------------------- |
| **Prometheus**    | Collects metrics from services and exporters (e.g., Node Exporter, cAdvisor) |
| **Grafana**       | Visualizes metrics and logs from Prometheus and Loki                         |
| **Loki**          | Collects and queries logs generated by the backend containers                |
| **Node Exporter** | Exposes system-level metrics of Kubernetes nodes                             |

---

## üèóÔ∏è Deployment Summary

### 1. Prometheus

* **Deployed** via Helm or static manifests.
* Scrapes metrics from:

  * Node Exporter (`/metrics`)
  * Kubernetes Pods and Services
  * cAdvisor (if included)

#### Example targets:

```yaml
- job_name: 'kubernetes-nodes'
  static_configs:
    - targets: ['<node-ip>:9100']
```

---

### 2. Loki

* **Deployed** via Helm or YAML manifest.
* Used with a sidecar or Fluent Bit/Promtail to collect logs.
* Configured to collect:

  * Pod logs from the Django backend
  * Logs are labeled by namespace, pod name, and container name

#### Loki labels used:

```yaml
pipeline_stages:
  - docker: {}
  - labels:
      job: "django-backend"
      app: "finch"
```

---

### 3. Grafana

* Reads metrics from **Prometheus**
* Reads logs from **Loki**
* Dashboards created:

  * Node Exporter Dashboard (system metrics)
  * Django API Performance
  * Loki Log Dashboard (search logs by namespace/pod/label)

#### Access:

* URL: `http://<grafana-ip>:3000`
* Default credentials: `admin / admin` (change this after first login)

---

## üìä Dashboards Overview

### Node Exporter

* CPU, Memory, Disk I/O, Network stats
* Useful to track cluster resource consumption

### Django (Finch Backend)

* Request count, response time, error rates
* Useful for backend health and performance

### Loki Logs

* Filters by:

  * Pod name
  * Log level (INFO, DEBUG, ERROR)
  * Message patterns (e.g., request paths, tracebacks)

---

## üö® Alerting Setup

### Prometheus AlertManager

* Alerts configured via **Prometheus Rules**.
* Common alerts:

  * High CPU/Memory usage
  * Pod crash loops
  * Backend 5xx errors

#### Sample Rule (High CPU):

```yaml
- alert: HighCPUUsage
  expr: rate(container_cpu_usage_seconds_total{pod=~"django.*"}[1m]) > 0.8
  for: 2m
  labels:
    severity: warning
  annotations:
    summary: "High CPU usage on Django pod"
    description: "CPU usage exceeds 80% for 2 minutes"
```

### Grafana Alerting (Optional)

* You can create alerts directly from dashboards.
* Alerts can notify via:

  * Email
  * Slack
  * Webhooks
  * Microsoft Teams

#### Steps:

1. Go to any panel ‚Üí Click the **alert icon**
2. Set condition (e.g., value > 90)
3. Choose notification channel
4. Save dashboard

---

## ‚úÖ How to Access and Manage

| Component  | Access Method                  |
| ---------- | ------------------------------ |
| Prometheus | `http://<ip>:9090`             |
| Grafana    | `http://<ip>:3000`             |
| Loki       | Internal API (used by Grafana) |

To manage these tools:

* Use `kubectl port-forward` or expose services via NodePort/Ingress.
* Create ConfigMaps for rules.
* Use Helm upgrade to reconfigure existing setups.

---
